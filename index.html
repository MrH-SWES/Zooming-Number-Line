<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Symmetrical Decimal Architect</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .arrow-card {
            box-shadow: 2px 4px 6px rgba(0,0,0,0.1);
            transition: all 0.2s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            border: 2px solid;
            position: relative;
        }
        .arrow-card:hover { transform: translateY(-2px); box-shadow: 4px 6px 10px rgba(0,0,0,0.15); }
        .arrow-card-left { border-radius: 8px 0 0 8px; justify-content: flex-end; padding-right: 8px; }
        .arrow-card-right { border-radius: 0 8px 8px 0; justify-content: flex-start; padding-left: 8px; }
        
        /* Grid Pattern for Number Line */
        .tick-line { stroke: #9CA3AF; stroke-width: 2; }
        .tick-text { font-size: 14px; fill: #4B5563; font-weight: 600; text-anchor: middle; cursor: pointer; }
        .tick-text:hover { fill: #2563EB; font-weight: 800; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { ArrowRight, Trash2, ZoomIn, ZoomOut, CheckCircle, XCircle } = lucide;

        // --- COMPONENTS ---

        // A single Arrow Card
        const ArrowCard = ({ value, place, side, widthLvl, active, onClick }) => {
            // Colors
            const bgClass = side === 'left' ? 'bg-blue-100 border-blue-600 text-blue-900' : 'bg-orange-100 border-orange-600 text-orange-900';
            const widthClass = widthLvl === 1 ? 'w-16' : widthLvl === 2 ? 'w-24' : 'w-32';
            const heightClass = 'h-16 text-3xl';
            
            // Logic for visual layering (Z-Index)
            // Small cards (Lvl 1) on top, Large cards (Lvl 3) on bottom
            const zIndex = 40 - (widthLvl * 10); 
            
            // Alignment styles for the "Stack"
            const stackStyle = active ? {
                position: 'absolute',
                zIndex: zIndex,
                [side === 'left' ? 'right' : 'left']: '0', // Anchor to center
                top: '50%',
                transform: 'translateY(-50%)'
            } : {};

            return (
                <div 
                    onClick={() => onClick(value, place)}
                    className={`arrow-card ${side === 'arrow-card-left' ? 'arrow-card-left' : 'arrow-card-right'} ${bgClass} ${widthClass} ${heightClass} ${active ? '' : 'm-1'}`}
                    style={stackStyle}
                >
                    {value}
                </div>
            );
        };

        const App = () => {
            // State: Builder
            const [builtNumber, setBuiltNumber] = useState({
                hundreds: null, tens: null, ones: null,
                tenths: null, hundredths: null
            });

            // State: Zoomer
            const [plottedNumber, setPlottedNumber] = useState(null);
            const [scale, setScale] = useState('ones'); // 'hundreds', 'tens', 'ones', 'tenths'
            const [feedback, setFeedback] = useState(null); // 'correct', 'incorrect', 'midpoint'

            // Helper: Calculate total value
            const getTotal = () => {
                let sum = 0;
                if(builtNumber.hundreds) sum += builtNumber.hundreds;
                if(builtNumber.tens) sum += builtNumber.tens;
                if(builtNumber.ones) sum += builtNumber.ones;
                if(builtNumber.tenths) sum += builtNumber.tenths;
                if(builtNumber.hundredths) sum += builtNumber.hundredths;
                return parseFloat(sum.toFixed(2));
            };

            // Builder Handlers
            const toggleCard = (val, place) => {
                setBuiltNumber(prev => ({
                    ...prev,
                    [place]: prev[place] === val ? null : val
                }));
            };

            const clearBuilder = () => {
                setBuiltNumber({ hundreds: null, tens: null, ones: null, tenths: null, hundredths: null });
                setPlottedNumber(null);
                setFeedback(null);
            };

            const handlePlot = () => {
                setPlottedNumber(getTotal());
                setFeedback(null);
                setScale('tenths'); // Default detailed view
            };

            // Zoomer Handlers
            const handleTickClick = (tickVal) => {
                if(plottedNumber === null) return;
                
                // Determine correct rounding based on scale
                let correct = false;
                let step = 1;
                if(scale === 'tens') step = 10;
                if(scale === 'hundreds') step = 100;
                if(scale === 'tenths') step = 0.1;

                // Math.round handles the .5 up rule correctly in JS
                // We simulate the "tie breaker" visual check logic
                const rounded = Math.round(plottedNumber / step) * step;
                // Fix floating point errors
                const cleanRounded = parseFloat(rounded.toFixed(2));
                const cleanTick = parseFloat(tickVal.toFixed(2));

                if (cleanTick === cleanRounded) {
                    setFeedback('correct');
                } else {
                    // Check if it was a midpoint error
                    const distance = Math.abs(plottedNumber - cleanTick);
                    const idealDistance = Math.abs(plottedNumber - cleanRounded);
                    
                    if (distance === idealDistance) {
                        setFeedback('midpoint'); // Technically math.round goes up, but catching the user confusion
                    } else {
                        setFeedback('incorrect');
                    }
                }
            };

            // SVG Logic for Number Line
            const renderNumberLine = () => {
                if (plottedNumber === null) return <div className="text-gray-400 text-xl font-medium mt-10">Plot a number to begin</div>;

                // Define view range based on plotted number and scale
                let step = 1;
                let viewRadius = 5; // How many steps to show left/right

                if(scale === 'tenths') { step = 0.1; viewRadius = 0.5; }
                if(scale === 'ones') { step = 1; viewRadius = 5; }
                if(scale === 'tens') { step = 10; viewRadius = 50; }
                if(scale === 'hundreds') { step = 100; viewRadius = 500; }

                // Center the view on the plotted number's neighborhood
                // We want integers to align nicely.
                const centerBase = Math.floor(plottedNumber / step) * step;
                const start = centerBase - (step * 2); 
                const end = centerBase + (step * 3);
                
                // Generate Ticks
                const ticks = [];
                for(let i = start; i <= end + (step/10); i += step) {
                    ticks.push(parseFloat(i.toFixed(2)));
                }

                // Calculate SVG positions
                const svgWidth = 800;
                const range = end - start;
                const getX = (val) => ((val - start) / range) * svgWidth;

                // Rounding Zones Logic
                // If we are rounding to Integers (Scale Ones), show the zones between integers
                let zones = null;
                if (scale !== 'tenths') { // Only show zones when we are zoomed out enough to round
                    const lowerInt = Math.floor(plottedNumber / step) * step;
                    const upperInt = lowerInt + step;
                    const midPoint = lowerInt + (step / 2);
                    
                    const xLower = getX(lowerInt);
                    const xMid = getX(midPoint);
                    const xUpper = getX(upperInt);
                    
                    zones = (
                        <g>
                            {/* Gray Bar (Lower Zone) - Ends just before mid */}
                            <rect x={xLower} y="70" width={xMid - xLower - 2} height="12" fill="#E5E7EB" rx="4" />
                            <text x={xLower + 10} y="80" fontSize="10" fill="#9CA3AF">Stay</text>
                            
                            {/* Blue Bar (Upper Zone) - Starts exactly at mid */}
                            <rect x={xMid} y="70" width={xUpper - xMid} height="12" fill="#DBEAFE" rx="4" /> 
                            {/* Visual Marker for "Start Line" */}
                            <rect x={xMid} y="65" width="2" height="22" fill="#2563EB" />
                            <text x={xMid + 5} y="80" fontSize="10" fill="#3B82F6">Next Up</text>
                        </g>
                    );
                }

                return (
                    <div className="relative w-full max-w-4xl mx-auto mt-8 p-4 bg-white rounded-xl shadow-sm border border-gray-200">
                        <svg width="100%" height="120" viewBox={`0 0 ${svgWidth} 120`}>
                            {/* Main Axis */}
                            <line x1="0" y1="50" x2={svgWidth} y2="50" stroke="#374151" strokeWidth="2" />

                            {/* Zones */}
                            {zones}

                            {/* Ticks */}
                            {ticks.map(val => (
                                <g key={val} onClick={() => handleTickClick(val)}>
                                    <line x1={getX(val)} y1="40" x2={getX(val)} y2="60" className="tick-line" />
                                    <rect x={getX(val)-20} y="10" width="40" height="30" fill="transparent" style={{cursor: 'pointer'}} />
                                    <text x={getX(val)} y="30" className="tick-text">{val}</text>
                                </g>
                            ))}

                            {/* The Ghost Dot */}
                            <circle cx={getX(plottedNumber)} cy="50" r="8" fill="#F59E0B" stroke="white" strokeWidth="2" />
                            
                            {/* The Floating Label */}
                            <foreignObject x={getX(plottedNumber) - 30} y="85" width="60" height="30">
                                <div className="text-center text-xs font-bold text-amber-600 bg-amber-50 rounded px-1 border border-amber-200">
                                    {plottedNumber}
                                </div>
                            </foreignObject>
                        </svg>

                        {/* Feedback Overlay */}
                        {feedback && (
                            <div className={`mt-4 text-center font-bold p-2 rounded ${
                                feedback === 'correct' ? 'bg-green-100 text-green-700' : 
                                feedback === 'midpoint' ? 'bg-blue-100 text-blue-700' : 'bg-red-100 text-red-700'
                            }`}>
                                {feedback === 'correct' ? "Correct! Good rounding." : 
                                 feedback === 'midpoint' ? "Look at the Blue Bar. It starts exactly at .5!" : 
                                 "Not quite. Look at which Zone the dot is in."}
                            </div>
                        )}
                    </div>
                );
            };

            return (
                <div className="min-h-screen flex flex-col items-center py-8 px-4 gap-6">
                    
                    <h1 className="text-3xl font-extrabold text-slate-800 tracking-tight">Decimal Architect</h1>
                    
                    {/* PANEL 1: THE BUILDER */}
                    <div className="w-full max-w-5xl bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200 flex flex-col">
                        <div className="bg-slate-50 p-3 border-b border-slate-200 flex justify-between items-center">
                            <span className="font-bold text-slate-500 text-sm tracking-wider uppercase">Panel 1: Build It</span>
                            <button onClick={clearBuilder} className="text-red-500 hover:bg-red-50 p-2 rounded flex items-center gap-2 text-sm font-bold">
                                <Trash2 size={16}/> Reset
                            </button>
                        </div>
                        
                        <div className="flex flex-col md:flex-row h-96">
                            {/* Left Zone (Wholes) */}
                            <div className="flex-1 bg-blue-50/50 border-r border-dashed border-slate-300 relative flex items-center justify-end pr-2">
                                <div className="absolute top-4 left-4 text-blue-300 font-bold text-6xl opacity-20">Whole</div>
                                
                                {/* The Stacking Area Left */}
                                <div className="relative w-40 h-20 mr-1"> 
                                    {/* Placeholders */}
                                    {builtNumber.hundreds && <ArrowCard value={builtNumber.hundreds} side="left" widthLvl={3} active={true} />}
                                    {builtNumber.tens && <ArrowCard value={builtNumber.tens} side="left" widthLvl={2} active={true} />}
                                    {builtNumber.ones && <ArrowCard value={builtNumber.ones} side="left" widthLvl={1} active={true} />}
                                    {!builtNumber.hundreds && !builtNumber.tens && !builtNumber.ones && <div className="absolute right-0 top-1/2 transform -translate-y-1/2 text-blue-200 font-bold text-xl">Drag Here</div>}
                                </div>
                            </div>

                            {/* THE MIRROR (Decimal Point) */}
                            <div className="w-12 bg-slate-800 flex items-center justify-center z-50 shadow-lg relative">
                                <div className="w-4 h-4 bg-white rounded-full"></div>
                                <div className="absolute -bottom-8 text-slate-800 font-bold">POINT</div>
                            </div>

                            {/* Right Zone (Decimals) */}
                            <div className="flex-1 bg-orange-50/50 border-l border-dashed border-slate-300 relative flex items-center justify-start pl-2">
                                <div className="absolute top-4 right-4 text-orange-300 font-bold text-6xl opacity-20">Part</div>
                                
                                {/* The Stacking Area Right */}
                                <div className="relative w-40 h-20 ml-1">
                                    {builtNumber.thousandths && <ArrowCard value={builtNumber.thousandths} side="right" widthLvl={3} active={true} />}
                                    {builtNumber.hundredths && <ArrowCard value={builtNumber.hundredths} side="right" widthLvl={2} active={true} />}
                                    {builtNumber.tenths && <ArrowCard value={builtNumber.tenths} side="right" widthLvl={1} active={true} />}
                                    {!builtNumber.tenths && !builtNumber.hundredths && <div className="absolute left-0 top-1/2 transform -translate-y-1/2 text-orange-200 font-bold text-xl">Drag Here</div>}
                                </div>
                            </div>
                        </div>

                        {/* The Palette */}
                        <div className="bg-white p-6 border-t border-slate-200">
                            <div className="flex flex-wrap justify-center gap-8">
                                {/* Hundreds */}
                                <div className="flex flex-col gap-2 items-center">
                                    <span className="text-xs font-bold text-blue-400 uppercase">Hundreds (Long)</span>
                                    <div className="flex gap-2">
                                        {[100, 200, 300].map(v => <ArrowCard key={v} value={v} place="hundreds" side="left" widthLvl={3} onClick={toggleCard} />)}
                                    </div>
                                </div>
                                {/* Tens */}
                                <div className="flex flex-col gap-2 items-center">
                                    <span className="text-xs font-bold text-blue-400 uppercase">Tens (Med)</span>
                                    <div className="flex gap-2">
                                        {[10, 20, 30, 40].map(v => <ArrowCard key={v} value={v} place="tens" side="left" widthLvl={2} onClick={toggleCard} />)}
                                    </div>
                                </div>
                                {/* Ones */}
                                <div className="flex flex-col gap-2 items-center">
                                    <span className="text-xs font-bold text-blue-400 uppercase">Ones (Short)</span>
                                    <div className="flex gap-2">
                                        {[1, 2, 3, 4, 5].map(v => <ArrowCard key={v} value={v} place="ones" side="left" widthLvl={1} onClick={toggleCard} />)}
                                    </div>
                                </div>
                                <div className="w-px bg-slate-300 mx-2"></div>
                                {/* Tenths */}
                                <div className="flex flex-col gap-2 items-center">
                                    <span className="text-xs font-bold text-orange-400 uppercase">Tenths (Short)</span>
                                    <div className="flex gap-2">
                                        {[0.1, 0.2, 0.3, 0.5].map(v => <ArrowCard key={v} value={v} place="tenths" side="right" widthLvl={1} onClick={toggleCard} />)}
                                    </div>
                                </div>
                                {/* Hundredths */}
                                <div className="flex flex-col gap-2 items-center">
                                    <span className="text-xs font-bold text-orange-400 uppercase">Hundredths (Med)</span>
                                    <div className="flex gap-2">
                                        {[0.01, 0.05, 0.06, 0.09].map(v => <ArrowCard key={v} value={v} place="hundredths" side="right" widthLvl={2} onClick={toggleCard} />)}
                                    </div>
                                </div>
                            </div>

                            <div className="mt-6 flex justify-center">
                                <button 
                                    onClick={handlePlot}
                                    disabled={getTotal() === 0}
                                    className="bg-slate-800 text-white px-8 py-3 rounded-full font-bold text-lg shadow-lg hover:bg-black hover:scale-105 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    PLOT {getTotal() > 0 && getTotal()} ON LINE <ArrowRight size={20} />
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* PANEL 2: THE ZOOMER */}
                    <div className="w-full max-w-5xl bg-white rounded-2xl shadow-xl border border-slate-200 p-6 min-h-[300px]">
                         <div className="flex justify-between items-center mb-4">
                            <span className="font-bold text-slate-500 text-sm tracking-wider uppercase">Panel 2: Round & Visualize</span>
                            
                            {/* Scale Controls */}
                            <div className="flex bg-slate-100 p-1 rounded-lg gap-1">
                                <button onClick={() => setScale('hundreds')} className={`px-4 py-1 text-sm font-bold rounded ${scale==='hundreds' ? 'bg-white shadow text-slate-800' : 'text-slate-400'}`}>Hundreds</button>
                                <button onClick={() => setScale('tens')} className={`px-4 py-1 text-sm font-bold rounded ${scale==='tens' ? 'bg-white shadow text-slate-800' : 'text-slate-400'}`}>Tens</button>
                                <button onClick={() => setScale('ones')} className={`px-4 py-1 text-sm font-bold rounded ${scale==='ones' ? 'bg-white shadow text-slate-800' : 'text-slate-400'}`}>Ones</button>
                                <button onClick={() => setScale('tenths')} className={`px-4 py-1 text-sm font-bold rounded ${scale==='tenths' ? 'bg-white shadow text-slate-800' : 'text-slate-400'}`}>Tenths</button>
                            </div>
                        </div>

                        <div className="bg-slate-50 rounded-xl border border-slate-200 h-64 flex flex-col items-center justify-center relative overflow-hidden">
                            {renderNumberLine()}
                        </div>
                        
                        <div className="mt-4 text-center text-slate-400 text-sm">
                            {scale !== 'tenths' ? 
                                "Tip: Click a number on the line to round the orange dot." : 
                                "Zoom out (change scale) to see rounding zones."
                            }
                        </div>
                    </div>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
